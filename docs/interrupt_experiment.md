# 中断与定时器实验文档

本实验旨在让学生掌握 STM32 的嵌套向量中断控制器 (NVIC)、外部中断 (EXTI) 以及通用定时器 (TIM) 的配置与使用方法。

## 1. 实验目标
- 掌握外部按键触发中断的初始化流程。
- 学习定时器的基本配置（预分频、自动重装载）。
- 理解中断服务函数 (ISR) 的编写要求及 volatile 变量的使用。

## 2. 实验内容

### 实验 1: 按键外部中断翻转 LED
使用外部中断模式读取按键 S1。
- **功能**: 当按下按键 S1 达到一定时长后，翻转所有 LED 的状态。
- **关键配置**: `Key_Init(KEY_MODE_EXTI)`。

### 实验 2: 二进制秒表
利用 `delay_ms` (通常基于 SysTick 中断) 实现 1 秒更新一次的累加计数器。
- **功能**: LED1-4 以二进制形式显示秒数（0-15 循环）。

### 实验 3: 可变频率闪烁 (定时器中断)
使用 TIM3 定时器中断控制 LED 闪烁频率。
- **功能**: 
  - 按下 S1: 闪烁间隔变为 1000ms (快速)。
  - 按下 S2: 闪烁间隔变为 4000ms (慢速)。
- **实现原理**: 在定时器中记录 `elapsed_ms`，达到目标值时翻转状态。

### 实验 4: 软件 PWM 亮度控制
通过高频定时器或软件循环模拟 PWM 信号。
- **功能**: 允许通过程序逻辑设置 LED 的有效电压，从而改变亮度。

### 实验 5: 呼吸灯效果
通过动态改变 PWM 占空比实现 LED 亮度的渐变效果。
- **现象**: LED 像呼吸一样平滑地由暗变亮，再由亮变暗。

## 3. 关键 API
- `NVIC_PriorityGroupConfig()`: 设置中断优先级分组。
- `TIM_TimeBaseInit()`: 配置定时器的时基参数。
- `Key_GetEvent(key)`: 在中断模式下获取按键触发事件。

## 4. 源码位置
- 代码实现: `exp/interupt_mian.c`
- 相关驱动: `User/source/stm32f10x_it.c` (中断服务函数汇集处)
